<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ticket.dao.TicketsMapper">
  <resultMap id="BaseResultMap" type="cn.ticket.entity.Tickets">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    <id column="wxs_ticket_id" jdbcType="BIGINT" property="Id" />
    <result column="wxs_trains_num" jdbcType="VARCHAR" property="trainsNum" />
    <result column="wxs_bus_type" jdbcType="INTEGER" property="busType" />
    <result column="wxs_departure_place" jdbcType="VARCHAR" property="departPlace" />
    <result column="wxs_destination" jdbcType="VARCHAR" property="destination" />
    <result column="wxs_departure_time" jdbcType="VARCHAR" property="departureTime" />
    <result column="wxs_ticket_price" jdbcType="REAL" property="ticketPrice" />
    <result column="wxs_count" jdbcType="INTEGER" property="count" />
    <result column="wxs_ticket_barrier" jdbcType="INTEGER" property="ticketBarrier" />
    <result column="wxs_seat_residual" jdbcType="VARCHAR" property="seatResidual" />
    <result column="wxs_date" jdbcType="VARCHAR" property="date" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    wxs_ticket_id, wxs_trains_num, wxs_bus_type, wxs_departure_place, wxs_destination, 
    wxs_departure_time, wxs_ticket_price, wxs_count, wxs_ticket_barrier, wxs_seat_residual, 
    wxs_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from table_wxs_ticket
    where wxs_ticket_id = #{Id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    delete from table_wxs_ticket
    where wxs_ticket_id = #{Id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.ticket.entity.Tickets">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    insert into table_wxs_ticket (wxs_ticket_id, wxs_trains_num, wxs_bus_type, 
      wxs_departure_place, wxs_destination, wxs_departure_time, 
      wxs_ticket_price, wxs_count, wxs_ticket_barrier, 
      wxs_seat_residual, wxs_date)
    values (#{Id,jdbcType=BIGINT}, #{trainsNum,jdbcType=VARCHAR}, #{busType,jdbcType=INTEGER}, 
      #{departPlace,jdbcType=VARCHAR}, #{destination,jdbcType=VARCHAR}, #{departureTime,jdbcType=VARCHAR}, 
      #{ticketPrice,jdbcType=REAL}, #{count,jdbcType=INTEGER}, #{ticketBarrier,jdbcType=INTEGER}, 
      #{seatResidual,jdbcType=VARCHAR}, #{date,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="cn.ticket.entity.Tickets">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    insert into table_wxs_ticket
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="Id != null">
        wxs_ticket_id,
      </if>
      <if test="trainsNum != null">
        wxs_trains_num,
      </if>
      <if test="busType != null">
        wxs_bus_type,
      </if>
      <if test="departPlace != null">
        wxs_departure_place,
      </if>
      <if test="destination != null">
        wxs_destination,
      </if>
      <if test="departureTime != null">
        wxs_departure_time,
      </if>
      <if test="ticketPrice != null">
        wxs_ticket_price,
      </if>
      <if test="count != null">
        wxs_count,
      </if>
      <if test="ticketBarrier != null">
        wxs_ticket_barrier,
      </if>
      <if test="seatResidual != null">
        wxs_seat_residual,
      </if>
      <if test="date != null">
        wxs_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="Id != null">
        #{Id,jdbcType=BIGINT},
      </if>
      <if test="trainsNum != null">
        #{trainsNum,jdbcType=VARCHAR},
      </if>
      <if test="busType != null">
        #{busType,jdbcType=INTEGER},
      </if>
      <if test="departPlace != null">
        #{departPlace,jdbcType=VARCHAR},
      </if>
      <if test="destination != null">
        #{destination,jdbcType=VARCHAR},
      </if>
      <if test="departureTime != null">
        #{departureTime,jdbcType=VARCHAR},
      </if>
      <if test="ticketPrice != null">
        #{ticketPrice,jdbcType=REAL},
      </if>
      <if test="count != null">
        #{count,jdbcType=INTEGER},
      </if>
      <if test="ticketBarrier != null">
        #{ticketBarrier,jdbcType=INTEGER},
      </if>
      <if test="seatResidual != null">
        #{seatResidual,jdbcType=VARCHAR},
      </if>
      <if test="date != null">
        #{date,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="cn.ticket.entity.Tickets">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    update table_wxs_ticket
    <set>
      <if test="trainsNum != null">
        wxs_trains_num = #{trainsNum,jdbcType=VARCHAR},
      </if>
      <if test="busType != null">
        wxs_bus_type = #{busType,jdbcType=INTEGER},
      </if>
      <if test="departPlace != null">
        wxs_departure_place = #{departPlace,jdbcType=VARCHAR},
      </if>
      <if test="destination != null">
        wxs_destination = #{destination,jdbcType=VARCHAR},
      </if>
      <if test="departureTime != null">
        wxs_departure_time = #{departureTime,jdbcType=VARCHAR},
      </if>
      <if test="ticketPrice != null">
        wxs_ticket_price = #{ticketPrice,jdbcType=REAL},
      </if>
      <if test="count != null">
        wxs_count = #{count,jdbcType=INTEGER},
      </if>
      <if test="ticketBarrier != null">
        wxs_ticket_barrier = #{ticketBarrier,jdbcType=INTEGER},
      </if>
      <if test="seatResidual != null">
        wxs_seat_residual = #{seatResidual,jdbcType=VARCHAR},
      </if>
      <if test="date != null">
        wxs_date = #{date,jdbcType=VARCHAR},
      </if>
    </set>
    where wxs_ticket_id = #{Id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="cn.ticket.entity.Tickets">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Feb 22 12:45:51 CST 2017.
    -->
    update table_wxs_ticket
    set wxs_trains_num = #{trainsNum,jdbcType=VARCHAR},
      wxs_bus_type = #{busType,jdbcType=INTEGER},
      wxs_departure_place = #{departPlace,jdbcType=VARCHAR},
      wxs_destination = #{destination,jdbcType=VARCHAR},
      wxs_departure_time = #{departureTime,jdbcType=VARCHAR},
      wxs_ticket_price = #{ticketPrice,jdbcType=REAL},
      wxs_count = #{count,jdbcType=INTEGER},
      wxs_ticket_barrier = #{ticketBarrier,jdbcType=INTEGER},
      wxs_seat_residual = #{seatResidual,jdbcType=VARCHAR},
      wxs_date = #{date,jdbcType=VARCHAR}
    where wxs_ticket_id = #{Id,jdbcType=BIGINT}
  </update>
	<select id="selectByNeed" resultMap="selectResultMap">
		select *
		from
		table_wxs_ticket t
		where t.wxs_departure_place = #{0} and
		t.wxs_destination =
		#{1} and t.wxs_date = #{2} and t.wxs_bus_type!= 3
		<!-- and unix_timestamp(t.wxs_departure_time)-unix_timestamp(current_time())> (60*60*1000) -->
		<!-- and (TO_DAYS(t.wxs_date) - TO_DAYS(NOW()) &lt; = 7 ) as result and 
			result &gt;=0 -->
	</select>
	<select id="selectByNeed_1" resultMap="selectResultMap">
		select *
		from
		table_wxs_ticket t
		where t.wxs_departure_place = #{0}  and t.wxs_date = #{1} and t.wxs_bus_type!= 3
		<!-- and unix_timestamp(t.wxs_departure_time)-unix_timestamp(current_time())> (60*60*1000) -->
		<!-- and (TO_DAYS(t.wxs_date) - TO_DAYS(NOW()) &lt; = 7 ) as result and 
			result &gt;=0 -->
	</select>
	<resultMap id="selectResultMap" type="cn.ticket.entity.Tickets">
		<id column="wxs_ticket_id" jdbcType="BIGINT" property="Id" />
		<result column="wxs_trains_num" jdbcType="VARCHAR" property="trainsNum" />
		<result column="wxs_bus_type" jdbcType="INTEGER" property="busType" />
		<result column="wxs_departure_place" jdbcType="VARCHAR" property="departPlace" />
		<result column="wxs_destination" jdbcType="VARCHAR" property="destination" />
		<result column="wxs_departure_time" jdbcType="VARCHAR" property="departureTime" />
		<result column="wxs_ticket_price" jdbcType="REAL" property="ticketPrice" />
		<result column="wxs_count" jdbcType="INTEGER" property="count" />
		<result column="wxs_ticket_barrier" jdbcType="INTEGER" property="ticketBarrier" />
		<result column="wxs_seat_residual" jdbcType="INTEGER" property="seatResidual" />
		<result column="wxs_date" jdbcType="VARCHAR" property="date" />
	</resultMap>
	<update id="updateBusType">
		update table_wxs_ticket 
		set wxs_bus_type = #{1} where wxs_trains_num = #{0} and (TO_DAYS(wxs_date) - TO_DAYS(NOW()) &gt;=0)  
	</update>

	<select id="queryForId" resultType="java.lang.Long">
		select wxs_ticket_id from table_wxs_ticket t where t.wxs_trains_num = #{0}
		and t.wxs_date = #{1} and t.wxs_departure_time = #{2}
	</select>
	<delete id="deleteByTrainsNum" parameterType="java.lang.String">
	  delete from table_wxs_ticket where wxs_trains_num = #{trainsNum,jdbcType=VARCHAR} 
	</delete>
	<select id="selectAllTicketsByCommon" resultMap="selectResultMap">
	   
	   select * from table_wxs_ticket t where t.wxs_bus_type = 1 and unix_timestamp(t.wxs_date) = unix_timestamp(date(now()))
	   
	</select>
	<select id="selectAllTickets" resultMap="selectResultMap">
	   
	   select * from table_wxs_ticket t where unix_timestamp(t.wxs_date) = unix_timestamp(date(now()))
	   
	</select>
	
</mapper>